{{ component( "Ceres::Item.Components.QuantityInput" ) }}

{% set itemsData = config("Ceres.basket.item_data")|split(', ') %}
{% set showItemVariation = config("Ceres.basket.variations") %}
{% set configItemName = config("Ceres.item.name") %}
{% set basketDetailsData = config("Ceres.basket.item_data")|split(', ') %}

<script type="x/template" id="vue-basket-list-item">
    <div class="basket-item-container" :class="{ 'basket-small': size === 'small', 'basket-large': size === 'large' }">
        
        <div class="basket-item component-loading with-icon sending" :class="{ 'isLoading': waiting }">

            <div class="quantity-input-container">
                <quantity-input template="#vue-quantity-input" @quantity-change="updateQuantity" :value="basketItem.quantity" :vertical="true" :waiting="isInputLocked" :variation-id="basketItem.variation.data.variation.id"
                                    :min="basketItem.variation.data.variation.minimumOrderQuantity" :max="basketItem.variation.data.variation.maximumOrderQuantity"></quantity-input>
            </div>

            <div class="image-container">
                <img class="img-basket-small" v-if="image" :src="image.url" :alt="altText">
            </div>

            <div class="meta-container">
                <div>
                    <div class="item-meta">
                        <a class="p-a-0" :href="basketItem.variation.data | itemURL">
                            <div class="item-name">
                                ${ basketItem.variation.data.texts |Â itemName({{ configItemName }}) }
                            </div>
                        </a>

                        <div class="item-total-price">${ basketItem.quantity * basketItem.variation.data.calculatedPrices.default.basePrice | currency(basketItem.variation.data.calculatedPrices.default.currency) }</div>

                        <div class="item-remove-button">
                            <button @click="deleteItem" :disabled="waiting || isBasketLoading" :class="{ 'text-muted': isBasketLoading && !waiting }">
                                <i v-waiting-animation="waiting" class="fa fa-trash-o" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>

                    <div class="item-base-price">
                        ${ basketItem.variation.data.calculatedPrices.default.basePrice | currency }
                    </div>

                    <div class="item-small-prices">
                        <div class="text-muted" v-if="!(basketItem.variation.data.unit.unitOfMeasurement === 'C62' && basketItem.variation.data.unit.content === 1) && basketItem.variation.data.variation.mayShowUnitPrice">
                            <div>${ basketItem.variation.data.calculatedPrices.formatted.basePrice }</div>
                            <div>
                                <strong>{{ trans("Ceres::Template.itemContent") }}: </strong>
                                ${ basketItem.variation.data.unit.content } ${ basketItem.variation.data.unit.names.name }
                            </div>
                        </div>

                        <div class="item-properties" v-if="basketItem.basketItemOrderParams.length">
                            <div class="item-properties-header">Ihre Angaben (Preis pro Artikel):</div>
                            <ul>
                                <li v-for="property in basketItem.basketItemOrderParams" :key="property.propertyId">

                                    <span :class="{ 'item-property-value': size === 'small' }">
                                        <strong>${ property.name } (+ ${ basketItem.variation.data.properties | propertySurcharge(property.propertyId) | currency }) </strong>
                                        <span v-if="size === 'small'">
                                            <span v-if="property.type === 'file'">
                                                <a :href="property.value | fileUploadPath" target="_blank">
                                                    <i class="fa fa-external-link" aria-hidden="true"></i>
                                                    ${ property.value | fileName }
                                                </a>
                                            </span>
                                            <span v-else>${ property.value }</span>
                                        </span>
                                    </span>

                                    <div v-if="size === 'large'">
                                        <span v-if="property.type === 'file'">
                                            <a :href="property.value | fileUploadPath" target="_blank">
                                                <i class="fa fa-external-link" aria-hidden="true"></i>
                                                ${ property.value | fileName }
                                            </a>
                                        </span>
                                        <span v-else>${ property.value }</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="item-additional-information" v-if="size === 'large' && showMoreInformation">

                        {% if "basket.item.item_id" in basketDetailsData %}
                            <div class="m-t-1">
                                <strong>{{ trans("Ceres::Template.itemId") }}:</strong>
                                <span>${ basketItem.itemId }</span>
                            </div>
                        {% endif %}

                        {% if "basket.item.customNumber" in basketDetailsData %}
                            <div v-if="basketItem.variation.data.variation.number">
                                <strong>{{ trans("Ceres::Template.itemNumber") }}:</strong>
                                <span>${ basketItem.variation.data.variation.number }</span>
                            </div>
                        {% endif %}

                        {% if "basket.item.availability" in basketDetailsData %}
                            <div v-if="basketItem.variation.data.variation.availability.names.name">
                                <strong>{{ trans("Ceres::Template.itemAvailability") }}:</strong>
                                <span>${ basketItem.variation.data.variation.availability.names.name }</span>
                            </div>
                        {% endif %}

                        {% if "basket.item.description_long" in basketDetailsData %}
                            <p class="m-y-1" v-if="basketItem.variation.data.texts.description" v-html="basketItem.variation.data.texts.description"></p>
                        {% endif %}

                        {% if "basket.item.description_short" in basketDetailsData %}
                            <p class="m-y-1" v-if="basketItem.variation.data.texts.description" v-html="basketItem.variation.data.texts.shortDescription"></p>
                        {% endif %}

                    </div>
                    
                    {% if "basket.item.item_id" in basketDetailsData or "basket.item.availability" in basketDetailsData or "basket.item.customNumber" in basketDetailsData or "basket.item.description_long" in basketDetailsData or "basket.item.description_short" in basketDetailsData %}
                        <label v-if="size === 'large'" @click="showMoreInformation = !showMoreInformation" class="basket-expand" :class="{ 'opened': showMoreInformation }" data-show-more="{{ trans("Ceres::Template.itemShowMore") }}" data-show-less="{{ trans("Ceres::Template.itemShowLess") }}"></label>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</script>
